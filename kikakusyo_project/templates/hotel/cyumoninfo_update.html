{% extends 'base.html' %}
{% block content %}
<p style="text-align: center;">{{ object.product.name }}: 残室数{{ object.product.stock }}</p>
<form id="updateForm" method="POST" style="text-align: center;">
    {% csrf_token %}
    <input type="hidden" name="id" value="{{ object.id }}">
    {{ form.as_p }}
    <input type="submit" value="更新">
</form>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    $('#updateForm').on('submit', function(e) {
        e.preventDefault();
        var formData = $(this).serialize();
        $.ajax({
            url: '{% url "hotel:update_quantity" %}',
            type: 'POST',
            data: formData,
            dataType: 'json',
            headers: {
                "X-CSRFToken": $("[name=csrfmiddlewaretoken]").val()
            },
            success: function(response) {
                if (response.success) {
                    alert('部屋数を変更いたしました');
                    window.location.href = '{% url "hotel:cyumon_info" %}';
                } else {
                    alert(response.error);
                }
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.error("AJAX エラー:", textStatus, errorThrown);
                alert('エラーが発生しました。もう一度お試しください。');
            }
        });
    });
});
</script>
{% endblock%}